# GitHub Copilot Coding Agent - SzczegÃ³Å‚owa Analiza Architektury

## Spis treÅ›ci
1. [PrzeglÄ…d systemu](#przeglÄ…d-systemu)
2. [Architektura aplikacji](#architektura-aplikacji)
3. [Model Context Protocol (MCP)](#model-context-protocol-mcp)
4. [GitHub Actions Runtime](#github-actions-runtime)
5. [Interfejs uÅ¼ytkownika](#interfejs-uÅ¼ytkownika)
6. [BezpieczeÅ„stwo i Firewall](#bezpieczeÅ„stwo-i-firewall)
7. [PrzepÅ‚yw danych i komunikacja](#przepÅ‚yw-danych-i-komunikacja)
8. [NarzÄ™dzia agenta](#narzÄ™dzia-agenta)
9. [Monitoring i Å›ledzenie sesji](#monitoring-i-Å›ledzenie-sesji)
10. [Integracja z GitHub Actions](#integracja-z-github-actions)

---

## PrzeglÄ…d systemu

### Czym jest GitHub Copilot Coding Agent?

GitHub Copilot Coding Agent to **autonomiczny AI deweloper**, ktÃ³ry dziaÅ‚a w tle na serwerach GitHub, wspierajÄ…c zespoÅ‚y developerskie w wykonywaniu zadaÅ„ programistycznych. W przeciwieÅ„stwie do zwykÅ‚ego Copilot Chat (ktÃ³ry dziaÅ‚a w edytorze), Coding Agent to w peÅ‚ni autonomiczny system dziaÅ‚ajÄ…cy w dedykowanym Å›rodowisku o izolacji, zasilanym przez GitHub Actions.

### Kluczowe cechy architektury:

| Cecha | Opis |
|-------|------|
| **Autonomia** | Agent pracuje niezaleÅ¼nie, podejmujÄ…c decyzje o tym, ktÃ³re pliki edytowaÄ‡, jakie komendy uruchamiaÄ‡ |
| **Izolacja** | KaÅ¼de zadanie uruchamiane w efemerycznym, stworzonym na Å¼Ä…danie kontenerze GitHub Actions |
| **Transparency** | Wszystkie dziaÅ‚ania agenta sÄ… widoczne w pull request'ach, timeline'ach i session logach |
| **IteratywnoÅ›Ä‡** | Agent moÅ¼e odpowiadaÄ‡ na feedback w PR i iteracyjnie doskonaliÄ‡ rozwiÄ…zanie |
| **Kontrola** | CzÅ‚owiek zawsze pozostaje w kontroli - alle zmiany wymagajÄ… human approval |

---

## Architektura aplikacji

### 1. Warstwa Prezentacji - Interfejs UÅ¼ytkownika

#### **Agents Panel** (GÅ‚Ã³wny interfejs)
```
Wszystkie strony GitHub.com
          â†“
[Przycisk Agents w navigation bar]
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AGENTS PANEL (Overlay)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Nowe zadanie (input prompt)       â”‚
â”‚ ğŸ‘€ TrwajÄ…ce zadania (real-time)      â”‚
â”‚ âœ“ UkoÅ„czone zadania                 â”‚
â”‚ ğŸ”— Linki do pull requestÃ³w           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
[View All / Full Screen Mode]
     github.com/copilot/agents
```

**MoÅ¼liwoÅ›ci Agents Panel:**
- Przypisanie nowego zadania bez opuszczania bieÅ¼Ä…cej pracy
- Monitorowanie statusu w real-time
- Szybki dostÄ™p do pull requestÃ³w do przeglÄ…du
- RÃ³wnolegÅ‚a obsÅ‚uga wielu zadaÅ„

#### **Punkty wejÅ›cia do taskÃ³w:**
1. **GitHub Issues**: Przypisanie issue do `@copilot`
2. **Pull Request Comments**: Mention `@copilot` w komentarzu
3. **Agents Panel**: BezpoÅ›rednie delegowanie z overlay
4. **VS Code**: Integracja z GitHub Pull Requests extension
5. **GitHub CLI**: `gh agent-task create`
6. **Raycast**: Custom integration
7. **MCP-enabled tools**: Dowolne narzÄ™dzie wspierajÄ…ce MCP

### 2. Warstwa Logiki - Core Agent Engine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           COPILOT CODING AGENT CORE ENGINE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Task Input Parser                                      â”‚
â”‚  â”œâ”€ Issue/PR context extraction                         â”‚
â”‚  â”œâ”€ Custom instructions parsing                         â”‚
â”‚  â””â”€ Repository metadata collection                      â”‚
â”‚                                                         â”‚
â”‚  Context Analyzer                                       â”‚
â”‚  â”œâ”€ RAG-powered code search (GitHub RAG)               â”‚
â”‚  â”œâ”€ Codebase structure analysis                         â”‚
â”‚  â”œâ”€ File dependency mapping                             â”‚
â”‚  â””â”€ Test suite discovery                                â”‚
â”‚                                                         â”‚
â”‚  Decision Engine (Multi-step Loop)                      â”‚
â”‚  â”œâ”€ Plan generation                                     â”‚
â”‚  â”œâ”€ Tool selection (bash, file editor, git, etc.)       â”‚
â”‚  â”œâ”€ Implementation execution                            â”‚
â”‚  â””â”€ Feedback iteration                                  â”‚
â”‚                                                         â”‚
â”‚  AI Provider Orchestration                              â”‚
â”‚  â”œâ”€ OpenAI (gpt-4-turbo-preview) - Primary              â”‚
â”‚  â”œâ”€ Anthropic Claude (fallback)                         â”‚
â”‚  â””â”€ Provider selection logic                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Warstwa Danych - Session Management

```
Session State Storage
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Cluster (Session Cache)      â”‚
â”‚  â”œâ”€ Active sessions                 â”‚
â”‚  â”œâ”€ Session metadata                â”‚
â”‚  â”œâ”€ Tool execution history          â”‚
â”‚  â””â”€ TTL: Session timeout            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
GitHub Persistent Storage
    â”œâ”€ Pull request body (plan)
    â”œâ”€ PR timeline (events)
    â”œâ”€ Commit history
    â””â”€ Session logs (JSON format)
```

---

## Model Context Protocol (MCP)

### Architektura MCP w kontekÅ›cie Copilot Agent

MCP to protokÃ³Å‚ komunikacyjny standaryzowany przez Anthropic, umoÅ¼liwiajÄ…cy AI agentom dostÄ™p do zewnÄ™trznych narzÄ™dzi i zasobÃ³w bez koniecznoÅ›ci zmian kodu core'owego agenta.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     COPILOT CODING AGENT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  MCP Client Layer                                   â”‚
â”‚  â”œâ”€ MCP Protocol Handler                           â”‚
â”‚  â”œâ”€ Tool Registry                                  â”‚
â”‚  â”œâ”€ Resource Manager                               â”‚
â”‚  â””â”€ Prompt Templates Handler                       â”‚
â”‚                       â”‚                            â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚              â”‚              â”‚             â”‚
â”‚        â†“              â†“              â†“             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Playwrightâ”‚  â”‚ GitHub   â”‚  â”‚  Custom  â”‚         â”‚
â”‚  â”‚   MCP    â”‚  â”‚   MCP    â”‚  â”‚   MCP    â”‚         â”‚
â”‚  â”‚ Server   â”‚  â”‚ Server   â”‚  â”‚ Servers  â”‚         â”‚
â”‚  â”‚(47 tools)â”‚  â”‚(47 tools)â”‚  â”‚          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NarzÄ™dzia dostÄ™pne przez MCP:

#### **Playwright MCP Server**
- Browser automation
- Visual testing
- Screenshot capture
- DOM interaction
- E2E test execution

#### **GitHub MCP Server** (47 endpoints)
- Repository operations
- Pull request management
- Issue manipulation
- Branch operations
- Workflow triggering

#### **Custom MCP Servers**
- Proprietary integrations
- External APIs
- Domain-specific tools
- Third-party services

### Konfiguracja MCP w repozytorium:

```json
{
  "mcpServers": [
    {
      "name": "github-mcp",
      "type": "github",
      "config": {
        "baseUrl": "https://api.github.com",
        "token": "${GITHUB_TOKEN}"
      }
    },
    {
      "name": "playwright-mcp",
      "type": "custom",
      "command": "node",
      "args": ["./node_modules/playwright-mcp/dist/index.js"]
    }
  ],
  "mcpEnabled": true
}
```

---

## GitHub Actions Runtime

### ArchitekturaExecutionu

Gdy task jest przypisany Copilotowi, system wykonuje nastÄ™pujÄ…ce kroki:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TASK ASSIGNMENT                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. BRANCH CREATION                                         â”‚
â”‚  Branch Name: copilot/{action-type}-{uuid}                 â”‚
â”‚  Example: copilot/fix-446c2c74-ca1b-48a8-a1a8-e608ccb59dea â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. PULL REQUEST CREATION                                   â”‚
â”‚  Status: DRAFT                                              â”‚
â”‚  Title: Auto-generated from task                            â”‚
â”‚  Body: Task description + Plan section (to be updated)      â”‚
â”‚  Linked: To original GitHub Issue/Prompt                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. GITHUB ACTIONS EPHEMERAL ENVIRONMENT SPINUP             â”‚
â”‚  Location: GitHub-hosted runner                            â”‚
â”‚  Image: ubuntu24 (20250818.1.0)                             â”‚
â”‚  Specs: Configurable (default sufficient)                   â”‚
â”‚  Network: Firewalled, controlled internet access            â”‚
â”‚  Lifetime: Duration of job + cleanup (59 min timeout)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ENVIRONMENT CONFIGURATION                               â”‚
â”‚  â”œâ”€ Repository clone                                        â”‚
â”‚  â”œâ”€ Dependencies installation                               â”‚
â”‚  â”œâ”€ Custom setup scripts execution                          â”‚
â”‚  â”œâ”€ Tools availability verification                         â”‚
â”‚  â””â”€ AI provider credentials configuration                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. AGENT EXECUTION LOOP (Multi-iteration)                  â”‚
â”‚                                                             â”‚
â”‚  Loop Iteration [1..N]:                                     â”‚
â”‚  â”œâ”€ Context Analysis                                        â”‚
â”‚  â”œâ”€ Plan Generation                                         â”‚
â”‚  â”œâ”€ Tool Invocation                                         â”‚
â”‚  â”œâ”€ Result Evaluation                                       â”‚
â”‚  â”œâ”€ Feedback Processing                                     â”‚
â”‚  â””â”€ Next Step Determination                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. PULL REQUEST UPDATE & FINALIZATION                      â”‚
â”‚  â”œâ”€ Final commits pushed                                    â”‚
â”‚  â”œâ”€ PR status changed from DRAFT to READY FOR REVIEW        â”‚
â”‚  â”œâ”€ PR body updated with final summary                      â”‚
â”‚  â””â”€ Session marked as complete                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. HUMAN REVIEW & ITERATION (if needed)                    â”‚
â”‚  â”œâ”€ Developer reviews changes                               â”‚
â”‚  â”œâ”€ Developer leaves comment with feedback                  â”‚
â”‚  â”œâ”€ Agent detects mention @copilot in comment               â”‚
â”‚  â”œâ”€ New iteration starts (back to step 5)                   â”‚
â”‚  â””â”€ Or: Manual merge if changes approved                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Runner Environment Variables

Podczas wykonywania zadania, agent ma dostÄ™p do specjalnych zmiennych Å›rodowiskowych:

```bash
# Task Identification
COPILOT_AGENT_ACTION="fix"                              # Type of action
COPILOT_AGENT_ISSUE_NUMBER="42"                         # Linked issue
COPILOT_AGENT_PR_NUMBER="1"                             # Working PR
COPILOT_AGENT_PR_COMMIT_COUNT="5"                       # Commits in PR

# Session Management
COPILOT_AGENT_START_TIME_SEC="1755803221"               # Unix timestamp
COPILOT_AGENT_TIMEOUT_MIN="59"                          # Session timeout
COPILOT_USE_SESSIONS="true"                             # Sessions enabled

# Branch & Identity
COPILOT_AGENT_BRANCH_NAME="copilot/fix-446c2c74..."    # Working branch
COPILOT_AGENT_COMMIT_LOGIN="copilot-swe-agent[bot]"    # Git identity
COPILOT_AGENT_COMMIT_EMAIL="198982749+Copilot@..."     # Email for commits

# Network & Security
COPILOT_AGENT_CALLBACK_URL="https://api.githubcopilot.com/agents/swe/agent"
COPILOT_API_URL="https://api.githubcopilot.com"
COPILOT_AGENT_FIREWALL_ENABLE_RULESET_ALLOW_LIST="true"
COPILOT_AGENT_FIREWALL_RULESET="[base64-encoded gzip rules]"
COPILOT_AGENT_CONTENT_FILTER_MODE="hidden_characters"

# Feature Flags
COPILOT_FEATURE_FLAGS="copilot_swe_agent_firewall_enabled_by_default,copilot_swe_agent_vision,..."
COPILOT_AGENT_DEBUG="false"                             # Debug mode
COPILOT_AGENT_ONLINE_EVALUATION_DISABLED="false"       # Evaluation active

# Integration
COPILOT_MCP_ENABLED="true"                              # MCP support
COPILOT_AGENT_MCP_SERVER_TEMP="/tmp/mcp-server"         # MCP temp dir

# Environment Type
COPILOT_AGENT_SOURCE_ENVIRONMENT="production"           # Prod/staging/dev
```

---

## Interfejs uÅ¼ytkownika

### 1. Agents Panel - SzczegÃ³Å‚owa Analiza

**Lokalizacja**: DostÄ™pny ze kaÅ¼dej strony GitHub.com

**Komponenty**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AGENTS PANEL (880px width)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” [Search/Filter Tasks]                       â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ STATUS: Running                         â”‚   â”‚
â”‚ â”‚ ğŸ• Task: "Add unit tests for Auth"      â”‚   â”‚
â”‚ â”‚ ğŸ“Š Progress: 45% (ETA: 2 min)           â”‚   â”‚
â”‚ â”‚ ğŸ“Œ Repo: arturwyroslak/neew              â”‚   â”‚
â”‚ â”‚ [View PR]                                â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ STATUS: Completed                       â”‚   â”‚
â”‚ â”‚ âœ“ Task: "Fix auth bug #42"              â”‚   â”‚
â”‚ â”‚ â±ï¸  Time: 5m 32s                         â”‚   â”‚
â”‚ â”‚ ğŸ“Œ Repo: organization/repo               â”‚   â”‚
â”‚ â”‚ [View PR] [Details]                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚ [+ New Task] [View All]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Task Creation Interface

```
Dialog: Create New Task
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task Description (required)             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ "Add dark mode support to the       â”‚ â”‚
â”‚ â”‚  settings page. Use React hooks    â”‚ â”‚
â”‚ â”‚  for state management."            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ Repository Selection:                   â”‚
â”‚ â”œâ”€ [Recent repos dropdown]              â”‚
â”‚ â”œâ”€ Currently: arturwyroslak/neew        â”‚
â”‚ â”‚ (or search for repo)                 â”‚
â”‚                                         â”‚
â”‚ Additional Context:                     â”‚
â”‚ â–¡ Link PR/Issue (#42)                   â”‚
â”‚ â–¡ Attach files                          â”‚
â”‚ â–¡ Custom instructions                   â”‚
â”‚                                         â”‚
â”‚ [Cancel] [Create Task]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Pull Request Timeline

Agent generuje PR z specjalnym struktur Ä… timeline'u:

```
Pull Request: copilot/fix-446c2c74...
Status: DRAFT â†’ READY FOR REVIEW

Timeline Events:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Event 1: ğŸ¤– "Copilot started work..."
Time: 2025-10-31 13:24:15
â”œâ”€ [View Session] â† Link to detailed logs
â””â”€ Session started (timeout: 59 min)

Event 2: ğŸ“‹ "Planning phase..."
â”œâ”€ Step 1: Analyze issue context
â”œâ”€ Step 2: Search related files
â”œâ”€ Step 3: Create implementation plan
â””â”€ [Expand]

Event 3: ğŸ’» "Implementing changes..."
â”œâ”€ Modified: src/auth.ts (+15, -8)
â”œâ”€ Modified: src/components/AuthForm.tsx (+25, -12)
â”œâ”€ Created: tests/auth.test.ts (NEW)
â””â”€ [Review Diff]

Event 4: âœ“ "Tests passing..."
â”œâ”€ Unit tests: 42/42 passed
â”œâ”€ Linter: No issues
â”œâ”€ Build: SUCCESS
â””â”€ Coverage: 87% â†’ 92%

Event 5: ğŸ“ "Updating PR..."
â”œâ”€ Adding summary
â”œâ”€ Marking as ready for review
â””â”€ Status: READY FOR REVIEW

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PR Body:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Copilot Implementation Plan

### Task
Fix authentication bug in user login flow (Issue #42)

### Plan
- [x] Analyze current auth implementation
- [x] Identify bug root cause
- [x] Create fix in auth.ts
- [x] Add comprehensive tests
- [x] Update documentation
- [x] Validate all tests pass

### Changes Made
1. **auth.ts**: Fixed token expiration handling
2. **AuthForm.tsx**: Added error boundary
3. **tests/auth.test.ts**: Added 12 new test cases

### Testing
- All existing tests: âœ“ PASSING
- New tests: âœ“ PASSING
- Coverage change: 85% â†’ 92%

### Deployment Notes
Recommend merging to `develop` branch before release
```

### 4. Session Logs View

```
Session View (github.com/copilot/agents/{sessionId})
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session: copilot-swe-agent-2025-10-31-13:24  â”‚
â”‚ Status: IN PROGRESS                          â”‚
â”‚                                              â”‚
â”‚ Statistics:                                  â”‚
â”‚ â”œâ”€ Time elapsed: 3m 42s                      â”‚
â”‚ â”œâ”€ Tools used: 47                            â”‚
â”‚ â”œâ”€ Files modified: 6                         â”‚
â”‚ â”œâ”€ Tokens used: 12,847 / 128,000             â”‚
â”‚ â””â”€ Confidence score: 87%                     â”‚
â”‚                                              â”‚
â”‚ Detailed Log (Real-time stream):             â”‚
â”‚                                              â”‚
â”‚ [13:24:15] Analyzing repository structure    â”‚
â”‚ [13:24:18] Found 127 TypeScript files        â”‚
â”‚ [13:24:22] Executing RAG search for context  â”‚
â”‚ [13:24:28] Identified 3 relevant files       â”‚
â”‚ [13:24:32] Planning implementation approach  â”‚
â”‚ [13:24:45] Using tool: read_file             â”‚
â”‚           â””â”€ file: src/auth.ts               â”‚
â”‚ [13:24:47] Using tool: search_code           â”‚
â”‚           â””â”€ query: "token expiration"       â”‚
â”‚ [13:24:52] AI reasoning: Found bug in line 127
â”‚ [13:24:55] Using tool: str_replace_based_edit
â”‚           â””â”€ file: src/auth.ts               â”‚
â”‚           â””â”€ from: (lines 125-130)           â”‚
â”‚           â””â”€ to: (lines 125-132)             â”‚
â”‚ [13:25:02] Using tool: bash_terminal         â”‚
â”‚           â””â”€ cmd: npm test                   â”‚
â”‚           â””â”€ output: 42 passed, 0 failed     â”‚
â”‚                                              â”‚
â”‚ [View More] [Download Log]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## BezpieczeÅ„stwo i Firewall

### eBPF Firewall Architecture

Copilot Agent posiada zaawansowany firewall bazujÄ…cy na eBPF (extended Berkeley Packet Filter), dziaÅ‚ajÄ…cy na poziomie kernel:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              KERNEL SPACE (eBPF Programs)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Network Packet Inspection                         â”‚
â”‚  â”œâ”€ Real-time packet filtering                     â”‚
â”‚  â”œâ”€ SSL/TLS certificate validation                 â”‚
â”‚  â”œâ”€ OCSP/CRL checking                              â”‚
â”‚  â””â”€ Malicious domain detection                     â”‚
â”‚                                                    â”‚
â”‚  Security Rules Engine                             â”‚
â”‚  â”œâ”€ Domain allowlisting (192MB base64 ruleset)    â”‚
â”‚  â”œâ”€ Path-based URL filtering                       â”‚
â”‚  â”œâ”€ HTTPS enforcement                              â”‚
â”‚  â””â”€ Real-time threat detection                     â”‚
â”‚                                                    â”‚
â”‚  Monitoring & Alerts                               â”‚
â”‚  â”œâ”€ Network activity logging (JSON)                â”‚
â”‚  â”œâ”€ Suspicious access detection                    â”‚
â”‚  â””â”€ PagerDuty integration for incidents            â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“ (syscall interception)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           COPILOT AGENT EXECUTION ENVIRONMENT      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Bash Tool / File Editor / Git Operations          â”‚
â”‚  (Commands passed through firewall checks)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Firewall Ruleset - Domeny zezwolone

**Default Allow List** (dekompresowany z 192MB gzip base64):

```yaml
# GitHub Infrastructure
- domain: github.com
  allow_subdomains: true
  scheme: https
  
- domain: githubusercontent.com
  allow_subdomains: true
  scheme: https

- domain: uploads.github.com
  paths:
    - /copilot/chat/attachments/
  scheme: https

# Container Registries
- domain: ghcr.io
  scheme: https
  
- domain: docker.io
  allow_subdomains: true
  scheme: https

# Package Managers
- domain: registry.npmjs.org
  scheme: https
  
- domain: registry.yarn.io
  scheme: https
  
- domain: pypi.org
  scheme: https
  
- domain: proxy.golang.org
  scheme: https

# Certificate Authorities
- domain: crl3.digicert.com
  scheme: https
  
- domain: ocsp.digicert.com
  scheme: https

# Azure Infrastructure (if configured)
- ip: 168.63.129.16  # Azure metadata service
  strict_ip_match: true
```

### Customizable Firewall Configuration

Administratorzy mogÄ… rozszerzyÄ‡/zmieniÄ‡ allowlist:

```
GitHub Settings â†’ Copilot â†’ Coding Agent â†’ Firewall Settings

Custom Allow List:
â”œâ”€ https://packages.contoso.corp/project-1/
â”œâ”€ npm-registry.mycompany.internal
â”œâ”€ api.service.mycompany.com
â””â”€ [+ Add Rule]

Allow List Strategy:
â—‹ Recommended (default)
â— Custom
â—‹ Disabled (âš ï¸ not recommended)
```

### Firewall Limitations i Security Model

1. **Only applies to agent-initiated processes**: MCP servers i Copilot setup steps not affected
2. **Only within GitHub Actions**: Desktop execution not covered
3. **Bypass potential**: Sophisticated attacks moÅ¼e bypass firewall

**Mitigation Strategy**:
- Layer defense z branch protections
- Code review requirements
- CI/CD validation gates
- Audit logging wszystkich operacji

---

## PrzepÅ‚yw danych i komunikacja

### Network Communication Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             COPILOT AGENT (GitHub Actions)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Application Layer                                   â”‚
â”‚  â”œâ”€ Agent Core (Node.js process)                     â”‚
â”‚  â”œâ”€ Session Manager                                  â”‚
â”‚  â””â”€ Tool Orchestrator                                â”‚
â”‚           â†“                                           â”‚
â”‚  Protocol Layer (JSON-RPC 2.0 + extensions)          â”‚
â”‚  â”œâ”€ WebSocket over TLS 1.3                           â”‚
â”‚  â”œâ”€ HTTP/2 fallback                                  â”‚
â”‚  â””â”€ Automatic reconnection (exponential backoff)     â”‚
â”‚           â†“                                           â”‚
â”‚  Security Layer                                      â”‚
â”‚  â”œâ”€ OAuth2 token authentication                      â”‚
â”‚  â”œâ”€ HMAC signature validation                        â”‚
â”‚  â”œâ”€ 30-second heartbeat ping/pong                    â”‚
â”‚  â””â”€ gzip compression                                 â”‚
â”‚           â†“                                           â”‚
â”‚  Transport Layer                                     â”‚
â”‚  â”œâ”€ Network interface (eth0)                         â”‚
â”‚  â”œâ”€ eBPF Firewall inspection                         â”‚
â”‚  â””â”€ TLS 1.3 encryption                               â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ (HTTPS/WSS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GITHUB COPILOT API (api.githubcopilot.com)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Copilot API Endpoints:                              â”‚
â”‚  â”œâ”€ POST /agents/swe/agent/jobs                      â”‚
â”‚  â”œâ”€ GET /agents/swe/agent/sessions/{id}              â”‚
â”‚  â”œâ”€ POST /agents/swe/agent/callbacks                 â”‚
â”‚  â””â”€ [47 additional endpoints]                        â”‚
â”‚                                                      â”‚
â”‚  AI Provider Routing:                                â”‚
â”‚  â”œâ”€ OpenAI (GPT-4 Turbo) [Primary]                   â”‚
â”‚  â””â”€ Anthropic Claude [Fallback]                      â”‚
â”‚                                                      â”‚
â”‚  Rate Limiting:                                      â”‚
â”‚  â”œâ”€ 5,000 req/hour (standard users)                  â”‚
â”‚  â”œâ”€ 500 req/hour (enterprise tier)                   â”‚
â”‚  â””â”€ Token limits: 30K tokens/minute                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EXTERNAL AI MODELS & SERVICES                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  OpenAI API                                          â”‚
â”‚  â”œâ”€ Model: gpt-4-turbo-preview                       â”‚
â”‚  â”œâ”€ Context window: 128K tokens                      â”‚
â”‚  â”œâ”€ Temperature: 0.3 (code), 0.7 (docs)              â”‚
â”‚  â””â”€ API v2024-02-15-preview                          â”‚
â”‚                                                      â”‚
â”‚  Anthropic API                                       â”‚
â”‚  â”œâ”€ Model: claude-3-sonnet-20240229                  â”‚
â”‚  â”œâ”€ Context window: 200K tokens                      â”‚
â”‚  â”œâ”€ Safety level: HIGH (Constitutional AI)           â”‚
â”‚  â””â”€ Used for fallback & complex reasoning            â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Message Format

```typescript
// JSON-RPC 2.0 Message Structure
interface CopilotProtocolMessage {
  jsonrpc: "2.0";
  method: string;  // e.g., "execute_tool", "request_feedback"
  params?: object;
  id?: string | number;
  
  // Response fields
  result?: any;
  error?: {
    code: number;
    message: string;
    data?: any;
  };
}

// Example: Execute bash command
{
  "jsonrpc": "2.0",
  "method": "bash_tool",
  "params": {
    "command": "npm test",
    "timeout": 120,
    "cwd": "/home/runner/work/repo"
  },
  "id": "bash-1"
}

// Example: Response
{
  "jsonrpc": "2.0",
  "id": "bash-1",
  "result": {
    "stdout": "42 tests passed",
    "stderr": "",
    "exit_code": 0
  }
}
```

### Session Lifecycle Communication

```
1. SESSION CREATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /agents/swe/agent/jobs              â”‚
â”‚ â”œâ”€ task_id: UUID                         â”‚
â”‚ â”œâ”€ repository: owner/name                â”‚
â”‚ â”œâ”€ issue_number: 42                      â”‚
â”‚ â””â”€ custom_instructions: string           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
Response: { session_id: "sess_xyz...", status: "initializing" }

2. SESSION POLLING / WEBHOOK
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /agents/swe/agent/sessions/{id}      â”‚
â”‚ Frequency: Every 5-10 seconds            â”‚
â”‚ (or WebSocket subscription)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
Response: { status: "running", progress: 0.45, current_step: "..." }

3. SESSION COMPLETION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /agents/swe/agent/callbacks         â”‚
â”‚ â”œâ”€ session_id: UUID                      â”‚
â”‚ â”œâ”€ status: "completed"                   â”‚
â”‚ â”œâ”€ pull_request_url: GitHub PR link      â”‚
â”‚ â””â”€ summary: Agent's work summary         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
GitHub API: Update PR / Create issue comment
```

---

## NarzÄ™dzia agenta

### Available Tools

Agent ma dostÄ™p do zaawansowanego zestawu narzÄ™dzi do wykonywania zadaÅ„:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT TOOLS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. FILE OPERATIONS (str_replace_based_editor)          â”‚
â”‚  â”œâ”€ read_file(path)                                     â”‚
â”‚  â”œâ”€ write_file(path, content)                           â”‚
â”‚  â”œâ”€ str_replace_based_edit_tool(...)                    â”‚
â”‚  â”‚   â”œâ”€ file: path                                      â”‚
â”‚  â”‚   â”œâ”€ from_str: original content                      â”‚
â”‚  â”‚   â””â”€ to_str: replacement content                     â”‚
â”‚  â””â”€ create_file(path, content)                          â”‚
â”‚                                                         â”‚
â”‚  2. BASH / TERMINAL (bash_tool)                         â”‚
â”‚  â”œâ”€ execute_command(cmd, timeout)                       â”‚
â”‚  â”œâ”€ get_command_output(cmd)                             â”‚
â”‚  â”œâ”€ cd(directory)                                       â”‚
â”‚  â””â”€ Approved tools only (security gated)                â”‚
â”‚                                                         â”‚
â”‚  3. GIT OPERATIONS (git_tool)                           â”‚
â”‚  â”œâ”€ git_commit(message, files)                          â”‚
â”‚  â”œâ”€ git_add(files)                                      â”‚
â”‚  â”œâ”€ git_push()                                          â”‚
â”‚  â”œâ”€ git_branch(name)                                    â”‚
â”‚  â”œâ”€ git_checkout(branch)                                â”‚
â”‚  â””â”€ git_status()                                        â”‚
â”‚                                                         â”‚
â”‚  4. CODEBASE ANALYSIS                                   â”‚
â”‚  â”œâ”€ search_code(query)                                  â”‚
â”‚  â”‚   â””â”€ RAG-powered search (GitHub's implementation)    â”‚
â”‚  â”œâ”€ find_similar_code(snippet)                          â”‚
â”‚  â”œâ”€ analyze_file_structure(path)                        â”‚
â”‚  â””â”€ get_project_metadata()                              â”‚
â”‚                                                         â”‚
â”‚  5. TEST & BUILD                                        â”‚
â”‚  â”œâ”€ run_tests(framework, pattern)                       â”‚
â”‚  â”œâ”€ run_linter(linter_name)                             â”‚
â”‚  â”œâ”€ build_project(build_command)                        â”‚
â”‚  â””â”€ coverage_check()                                    â”‚
â”‚                                                         â”‚
â”‚  6. DOCUMENTATION                                       â”‚
â”‚  â”œâ”€ generate_documentation(file)                        â”‚
â”‚  â”œâ”€ update_readme(section, content)                     â”‚
â”‚  â””â”€ generate_changelog_entry()                          â”‚
â”‚                                                         â”‚
â”‚  7. MCP TOOLS (via Model Context Protocol)              â”‚
â”‚  â”œâ”€ Playwright tools (47 endpoints)                     â”‚
â”‚  â”œâ”€ GitHub API tools (47 endpoints)                     â”‚
â”‚  â””â”€ Custom tool integrations                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tool Execution Flow

```
Agent Decision Loop:
    â†“
Tool Selection Engine
â”œâ”€ Analyze current state
â”œâ”€ Determine next action
â”œâ”€ Select appropriate tool
â””â”€ Prepare tool parameters
    â†“
Tool Invocation
â”œâ”€ Validate parameters
â”œâ”€ Check permissions/firewall
â”œâ”€ Execute tool
â””â”€ Capture output/errors
    â†“
Result Evaluation
â”œâ”€ Parse tool output
â”œâ”€ Check for errors
â”œâ”€ Update internal state
â””â”€ Generate next prompt for AI
    â†“
Feedback Loop
â””â”€ If success: Continue iteration or finish
    â””â”€ If failure: Adjust strategy, retry or escalate
```

---

## Monitoring i Å›ledzenie sesji

### Session Tracking Mechanisms

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SESSION TRACKING ARCHITECTURE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  REAL-TIME TRACKING                                  â”‚
â”‚  â”œâ”€ Agents Panel (live updates)                      â”‚
â”‚  â”‚  â””â”€ WebSocket connection to GitHub                â”‚
â”‚  â”‚                                                   â”‚
â”‚  â”œâ”€ VS Code Integration                              â”‚
â”‚  â”‚  â””â”€ GitHub Pull Requests extension                â”‚
â”‚  â”‚                                                   â”‚
â”‚  â”œâ”€ GitHub CLI (gh agent-task view --follow)         â”‚
â”‚  â”‚  â””â”€ Streaming session logs in terminal            â”‚
â”‚  â”‚                                                   â”‚
â”‚  â””â”€ Web UI (Session View)                            â”‚
â”‚     â””â”€ Detailed logs with timestamps                 â”‚
â”‚                                                      â”‚
â”‚  PERSISTENT LOGGING                                  â”‚
â”‚  â”œâ”€ Session metadata (Redis)                         â”‚
â”‚  â”œâ”€ Detailed logs (GitHub PR timeline)               â”‚
â”‚  â”œâ”€ AI reasoning ("internal monologue")              â”‚
â”‚  â”œâ”€ Tool invocations                                 â”‚
â”‚  â””â”€ Token usage tracking                             â”‚
â”‚                                                      â”‚
â”‚  METRICS & ANALYTICS                                 â”‚
â”‚  â”œâ”€ Success rate                                     â”‚
â”‚  â”œâ”€ Average time to completion                       â”‚
â”‚  â”œâ”€ Tool usage patterns                              â”‚
â”‚  â”œâ”€ Error rates                                      â”‚
â”‚  â””â”€ Model performance metrics                        â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session Log Structure

```json
{
  "session_id": "sess-2025-10-31-13:24:15-xyz",
  "task_id": "task-446c2c74",
  "created_at": "2025-10-31T13:24:15.000Z",
  "status": "completed",
  "total_duration_seconds": 312,
  "metrics": {
    "tokens_used": 12847,
    "tokens_limit": 128000,
    "tools_invoked": 47,
    "files_modified": 6,
    "files_created": 3,
    "commits_made": 5,
    "test_passed": 42,
    "test_failed": 0,
    "confidence_score": 0.87
  },
  "events": [
    {
      "timestamp": "2025-10-31T13:24:15.123Z",
      "event_type": "session_started",
      "details": "Agent initialized for issue #42"
    },
    {
      "timestamp": "2025-10-31T13:24:22.456Z",
      "event_type": "tool_invoked",
      "tool_name": "search_code",
      "params": { "query": "authentication token" },
      "result": "Found 5 relevant files"
    },
    {
      "timestamp": "2025-10-31T13:24:45.789Z",
      "event_type": "ai_reasoning",
      "reasoning": "Bug identified in token expiration logic at line 127 of auth.ts. Token refresh mechanism not triggered properly.",
      "confidence": 0.92
    },
    {
      "timestamp": "2025-10-31T13:25:02.012Z",
      "event_type": "file_modified",
      "file_path": "src/auth.ts",
      "lines_added": 5,
      "lines_removed": 2
    },
    {
      "timestamp": "2025-10-31T13:25:15.345Z",
      "event_type": "test_run",
      "test_count": 42,
      "passed": 42,
      "failed": 0,
      "duration_ms": 3500
    }
  ],
  "pull_request": {
    "number": 1,
    "url": "https://github.com/arturwyroslak/neew/pull/1",
    "status": "draft",
    "files_changed": 6
  }
}
```

### Tracking Points DostÄ™pu

1. **GitHub Web UI**
   - Agents Panel (every page)
   - Dedicated agents tab (github.com/copilot/agents)
   - PR timeline with session link

2. **VS Code**
   - GitHub Pull Requests extension
   - Sessions view (experimental setting)
   - Inline notifications

3. **GitHub CLI**
   - `gh agent-task list` - List all sessions
   - `gh agent-task view {pr}` - View specific session
   - `gh agent-task view --log --follow` - Real-time stream

4. **API Access**
   - GraphQL: Query session status
   - REST: `/repos/{owner}/{repo}/pulls/{number}`
   - WebSocket: Subscribe to real-time updates

---

## Integracja z GitHub Actions

### Workflow Configuration dla Copilot

KaÅ¼de repozytorium moÅ¼e mieÄ‡ dedicatowany workflow do konfiguracji Copilot environment:

```yaml
# .github/workflows/copilot-setup.yml
name: Copilot Agent Setup

on:
  workflow_call:
    inputs:
      node_version:
        type: string
        default: "20"

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ inputs.node_version }}
          cache: npm
      
      - name: Install dependencies
        run: npm install --prefer-offline
      
      - name: Install global tools
        run: |
          npm install -g eslint prettier
          pip install black mypy
      
      - name: Verify environment
        run: |
          node --version
          npm --version
          python --version
      
      - name: Build project
        run: npm run build
      
      - name: Run linters
        run: npm run lint
      
      - name: Run tests
        run: npm test
```

### Environment Configuration

```yaml
# .github/workflows/copilot-env.yml
name: Copilot Custom Environment

on: workflow_dispatch

jobs:
  configure:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      # Custom environment setup
      - name: Install database drivers
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client mysql-client
      
      - name: Setup Docker
        uses: docker/setup-buildx-action@v2
      
      - name: Configure secrets
        env:
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_USER: ${{ secrets.DB_USER }}
        run: |
          echo "Environment configured"
          # Copilot will have access to these secrets
```

### Feature Flags & Configuration

Copilot agent respektuje konfiguracjÄ™ repository i feature flags:

```yaml
# Repository Settings: Copilot â†’ Coding Agent â†’ Configuration

features:
  firewall_enabled: true
  mcp_enabled: true
  vision_enabled: true
  lsp_diagnostics: true
  sync_pr_title: true

firewall:
  enabled: true
  allow_list:
    - "https://npm-registry.contoso.corp/"
    - "api.service.mycompany.com"
    - domain: "github.com"
      allow_subdomains: true

mcp_servers:
  - name: "github-mcp"
    enabled: true
  - name: "playwright-mcp"
    enabled: true

custom_instructions: |
  Always follow our coding standards:
  - Use ESLint configuration from .eslintrc.json
  - Write tests using Jest framework
  - Follow the PR template in CONTRIBUTING.md
  - Ensure 90%+ code coverage for new code

rate_limits:
  max_tasks_per_day: 100
  timeout_minutes: 59
```

---

## Podsumowanie Architektury

### Kluczowe warstwy systemu:

| Warstwa | Komponenty | Funkcja |
|---------|-----------|---------|
| **Interfejsu** | Agents Panel, PR UI, CLI, IDEs | Interakcja z uÅ¼ytkownikiem |
| **Logiki** | Agent Engine, Decision Loop, Tools | Autonomiczna logika biznesowa |
| **Danych** | Session State, Redis, GitHub API | TrwaÅ‚oÅ›Ä‡ i zarzÄ…dzanie stanem |
| **Wykonania** | GitHub Actions, eBPF Firewall, Containers | Izolowana, bezpieczna egzekucja |
| **Integracji** | MCP, OpenAI, Anthropic, GitHub | PoÅ‚Ä…czenia zewnÄ™trzne |
| **BezpieczeÅ„stwa** | Firewall, Tokens, HMAC, TLS 1.3 | Ochrona danych i dostÄ™pu |

### PrzepÅ‚yw techniczny end-to-end:

```
UÅ¼ytkownik klika "Assign to Copilot"
        â†“
Agents Panel tworzy task w GitHub API
        â†“
GitHub Actions job spinup
        â†“
Agent inicjalizuje siÄ™ w containerze
        â†“
Pobiera kontekst z repozytorium
        â†“
Loop: Analyze â†’ Plan â†’ Execute â†’ Validate â†’ Iterate
        â†“
Pushuje zmiany i tworzy PR
        â†“
Session loguje siÄ™ w GitHub timeline
        â†“
UÅ¼ytkownik przeglÄ…da i zatwierdza
        â†“
Merge do main branch
```

### Cechy architektoniczne:

âœ… **Autonomia** - Agent podejmuje decyzje niezaleÅ¼nie
âœ… **BezpieczeÅ„stwo** - Wielowarstwowa ochrona, firewall eBPF
âœ… **TransparentnoÅ›Ä‡** - Wszystkie operacje widoczne w UI
âœ… **SkalowlanoÅ›Ä‡** - GitHub Actions handles parallization
âœ… **Extensibility** - MCP pozwala na integracje custom
âœ… **Kontrola** - CzÅ‚owiek zawsze moÅ¼e review i approve
âœ… **Compliance** - Audit logs, branch protections, approvals
